---
type Props = {
  title: string;
  description: string;
  canonical: string;
  ogImage?: string;
  gtmId?: string;
  schemaJson?: any;
};

const {
  title,
  description,
  canonical,
  ogImage,
  gtmId = "GTM-KZQV2SN",
  schemaJson,
} = Astro.props;
---

<!doctype html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="robots" content="index,follow" />
    <link rel="canonical" href={canonical} />

    <title>{title}</title>
    <meta name="description" content={description} />

    <!-- Open Graph -->
    <meta property="og:locale" content="fa_IR" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={canonical} />
    {ogImage && <meta property="og:image" content={ogImage} />}

    <!-- Preload font -->
    <link
      rel="preload"
      href="/Vazir-Medium.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />

 
  <style is:global>
  @font-face{
    font-family:"Vazir";
    src:url("/Vazir-Medium.woff2") format("woff2");
    font-display:swap;
    font-weight:500;
    font-style:normal;
  }

  :root { color-scheme: light; }
  * { box-sizing: border-box; }
  html, body { margin: 0; padding: 0; }

  body{
    font-family:"Vazir", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background:#ffffff;
    color:#111;
    line-height:1.7;
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  a{ color: inherit; text-decoration: none; }
  a:visited{ color: inherit; }

  .container{
    width: min(1120px, 100%);
    margin: 0 auto;
    padding-inline: 16px;
  }
</style>

    <!-- GTM -->
    {gtmId && (
      <script is:inline>
        {`(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','${gtmId}');`}
      </script>
    )}


   <script is:inline>
{`
window.dataLayer = window.dataLayer || [];

function dl(eventName, payload){
  try{
    window.dataLayer.push(Object.assign({
      event: eventName,
      page_path: location.pathname,
      page_title: document.title
    }, payload || {}));
  }catch(e){}
}

// page view signal
dl('page_view_custom');

// click tracking by data-track
document.addEventListener('click', function(e){
  var el = e.target && e.target.closest ? e.target.closest('[data-track]') : null;
  if(!el) return;

  var name = el.getAttribute('data-track') || '';
  var meta = el.getAttribute('data-track-meta') || '';
  var href = el.getAttribute('href') || '';

  // tel clicks
  if(href && href.startsWith('tel:')){
    dl('tel_click', { name: name || 'tel', label: meta || href.replace('tel:','') });
    return;
  }

  // generic
  dl('ui_click', { name: name, label: meta, href: href });
}, { passive: true });

document.addEventListener('toggle', function(e){
  var d = e.target;
  if(!d || d.tagName !== 'DETAILS') return;
  if(!d.hasAttribute('data-faq')) return;
  if(d.open){
    dl('faq_open', { label: d.getAttribute('data-faq') || '' });
  }
}, true);

// scroll depth (25/50/75/90)
(function(){
  var fired = {};
  function check(){
    var doc = document.documentElement;
    var scrollTop = window.scrollY || doc.scrollTop || 0;
    var height = (doc.scrollHeight || 0) - (window.innerHeight || 0);
    if(height <= 0) return;
    var p = Math.round((scrollTop / height) * 100);

    [25,50,75,90].forEach(function(t){
      if(!fired[t] && p >= t){
        fired[t] = true;
        dl('scroll_depth', { percent: t });
      }
    });
  }
  window.addEventListener('scroll', check, { passive: true });
  check();
})();

// time on page pings
setTimeout(function(){ dl('time_on_page', { seconds: 15 }); }, 15000);
setTimeout(function(){ dl('time_on_page', { seconds: 45 }); }, 45000);
`}
</script>
{schemaJson && (
  <script type="application/ld+json" is:inline>
    {JSON.stringify(schemaJson)}
  </script>
)}
  </head>

  <body>
    {gtmId && (
      <noscript>
        <iframe
          src={`https://www.googletagmanager.com/ns.html?id=${gtmId}`}
          height="0"
          width="0"
          style="display:none;visibility:hidden"
          title="gtm"
        />
      </noscript>
    )}

    <slot />
  </body>
</html>